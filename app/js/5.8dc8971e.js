(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"00d3":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flex min-height-inherit"},[e.inline?e._e():a("div",{staticClass:"min-height-inherit position-relative workspace-toolbox",class:{blocklyToolboxDelete:!!e.blockBeingDragged},staticStyle:{flex:"0 0 auto"},on:{mouseenter:function(t){e.isMouseInQuasarToolbox=!0},mouseleave:function(t){e.isMouseInQuasarToolbox=!1}}},[a("div",{staticClass:"q-pa-sm flex column"},[a("q-list",[e._l(e.toolbox,(function(t){return["sep"===t.tag?a("q-separator"):a("q-item",{style:"color:"+t.colour,attrs:{clickable:"",active:e.isFlyoutOpen&&e.isFlyoutOpen===t.name},on:{click:function(a){return e.toggleToolboxFlyout(t,a)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{style:"color:"+t.colour,attrs:{name:t.icon}})],1),a("q-item-section",{staticClass:"gt-sm"},[a("q-item-label",{style:"color:"+t.colour},[e._v(e._s(t.name))])],1)],1)]}))],2),a("q-list",{staticStyle:{flex:"0 0 auto"},attrs:{dense:""}},[e._t("default")],2)],1)]),a("div",{staticClass:"min-height-inherit position-relative",on:{click:e.closeToolboxFLyout}},[a("div",{staticClass:"blockly",class:{"blockly-inline":e.inline},staticStyle:{"min-height":"inherit"}},[a("div",{ref:"blockly",staticClass:"blockly-wrap"}),a("xml",{ref:"toolbox",staticStyle:{display:"none"}},[e._l(e.toolbox,(function(t){return[a(t.tag,{tag:"component",attrs:{name:t.name,colour:t.colour,custom:t.custom}},[e._l(t.children,(function(t){return[a(t.tag,{tag:"component",attrs:{type:t.type,colour:t.colour}},[e._l(t.children,(function(t){return[a(t.tag,{tag:"component",attrs:{id:t.id,op:t.op,at:t.at,items:t.items,statement:t.statement,mode:t.mode,at1:t.at1,at2:t.at2,divisor_input:t.divisor_input,name:t.name,colour:t.colour}},[e._v(e._s(t.value)),e._l(t.children,(function(t){return[a(t.tag,{tag:"component",attrs:{type:t.type,name:t.name}},[e._v(e._s(t.value)),e._l(t.children,(function(t){return[a(t.tag,{tag:"component",attrs:{name:t.name}},[e._v(e._s(t.value))])]}))],2)]}))],2)]}))],2)]}))],2)]}))],2)],1)])])},o=[],r=(a("ddb0"),a("ded3")),l=a.n(r),i=a("54ca"),s=a.n(i),c=a("2f62"),u="/**\r\n * Simple tests\r\n */\r\nhasNumber = /\\d/\r\n \r\n/**\r\n * Stores events being listened to\r\n * {eventName: [...callbacks]}\r\n */\r\n_events = {}\r\n\r\n/**\r\n * console.log helper to properly send data to main app w/o obfuscation\r\n */\r\nconsole = {\r\n  log: function (arguments) {\r\n    log(JSON.stringify(arguments))\r\n  }\r\n}\r\n\r\n/**\r\n * target.addEventListener subsitution\r\n * @param {String} eventName The eventName to store this callback under\r\n * @param {Array} args The list of arguments\r\n * @param {Function} callback The function to call when this event is triggered\r\n */\r\naddEventListener = function (eventName, args, callback) {\r\n  if (!_events[eventName]) {\r\n    _events[eventName] = []\r\n  }\r\n\r\n  _events[eventName].push({\r\n    args: args,\r\n    callback: callback\r\n  })\r\n}\r\n\r\n/**\r\n * Trigger an event\r\n * @param {String} eventName \r\n * @param {*} payload\r\n */\r\ntriggerEvent = function (eventName, payload) {\r\n  _events[eventName] && _events[eventName].forEach(function (event) {\r\n    event.callback({\r\n      args: event.args,\r\n      payload: JSON.parse(payload)\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * Plays a note\r\n */\r\nplayNote = function (payload) {\r\n  _playNote(JSON.stringify(payload))\r\n}\r\n\r\n/**\r\n * Compre helper for working with \"is\", \"is not\", etc\r\n */\r\ncompare = function (a, compare, b) {\r\n  switch (compare) {\r\n    case 'is':\r\n      return a == b\r\n    case 'is not':\r\n      return a != b\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if a string belongs to the \"is any\" family (\"all\", \"any\", etc)\r\n */\r\nisAny = function (str) {\r\n  var list = ['any', 'all']\r\n  var isValid = false\r\n\r\n  list.forEach(function (item) {\r\n    if (str === item) isValid = true\r\n  });\r\n\r\n  return isValid\r\n}\r\n\r\n/**\r\n * Checks if a given note matches a webmidi.name\r\n * - If no octave present, then matches the key in any octave\r\n */\r\nisNote = function (a, compare, b) {\r\n  switch (compare) {\r\n    case 'is':\r\n      if (hasNumber.test()) {\r\n        return a == b.name.concat(b.octave)\r\n      } else {\r\n        return a == b.name\r\n      }\r\n\r\n    case 'is not':\r\n      if (hasNumber.test()) {\r\n        return a != b.name.concat(b.octave)\r\n      } else {\r\n        return a != b.name\r\n      }\r\n  }\r\n}",d=a("c62b"),m=a.n(d),h=a("2ef0"),g=a("7724"),p=a.n(g),b=s.a.Theme.defineTheme("midiblocks",{blockStyles:{logic_blocks:{colourPrimary:"#5d37f0",colourSecondary:"#635697",colourTertiary:"#453974"},loop_blocks:{colourPrimary:"#2ca300",colourSecondary:"#328514",colourTertiary:"#2d621a"},math_blocks:{colourPrimary:"#a599e9",colourSecondary:"#7e77a9",colourTertiary:"#575467"},procedure_blocks:{colourPrimary:"#ff628c",colourSecondary:"#b56278",colourTertiary:"#6e3c49"},variable_blocks:{colourPrimary:"#ff628c",colourSecondary:"#b56278",colourTertiary:"#6e3c49"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}}}),y=a("3e52"),f={name:"Blockly",props:["options","toolbox","blocks","inline"],computed:l()({},Object(c["b"])(["devices"])),data(){return{blockly:null,interpreter:null,isFlyoutOpen:!1,blockBeingDragged:!1,lastClickedCategory:null,isMouseInQuasarToolbox:!1}},mounted(){let e=this.$props.options||{};e=Object(h["defaults"])(this.$props.options,{renderer:"zelos",sounds:!1,toolbox:this.$refs.toolbox,media:"media/",zoom:{controls:!0,pinch:!0,wheel:!0,startScale:.8},grid:{spacing:50,length:50,colour:"#9effff",snap:!0},theme:b}),this.blockly=s.a.inject(this.$refs.blockly,e),this.blockly.addChangeListener(this.onChange),this.$root.$on("blockly.prompt.submit",this.onPromptSubmit),this.addBlocks()},beforeDestroy(){this.$root.$off("blockly.prompt.submit",this.onPromptSubmit)},methods:{onChange(e){this.$emit("change",e),"dragStart"===e.element?this.blockBeingDragged=e:"dragStop"===e.element&&(this.isMouseInQuasarToolbox&&this.blockly.getBlockById(e.blockId).dispose(),this.blockBeingDragged=!1)},toggleToolboxFlyout(e,t){if(this.isFlyoutOpen===e.name)return this.blockly.getFlyout().hide(),this.isFlyoutOpen=null,void(this.lastClickedCategory=null);let a=[];e.custom?this.blockly.getFlyout().show(e.custom):(e.children.forEach(e=>{a.push(document.querySelector(`block[type="${e.type}"]`))}),this.blockly.getFlyout().show(a)),this.isFlyoutOpen=e.name,this.lastClickedCategory=t.target},onPromptSubmit(e){this.lastClickedCategory&&this.lastClickedCategory.click()},closeToolboxFLyout(e){let t=e.path.some(e=>e.classList&&e.classList.contains("blocklyFlyoutBackground"));this.isFlyoutOpen&&!t&&(this.blockly.getFlyout().hide(),this.isFlyoutOpen=!1)},run(){const e=s.a.JavaScript.workspaceToCode(this.blockly);this.interpreter=new p.a(y["transform"](u+"\n"+e,{presets:["env"],sourceType:"script"}).code,this.setupInterpreter),this.interpreter.run()},setupInterpreter(e,t){e.setProperty(t,"log",e.createNativeFunction(e=>{console.log("ðŸ“¦ log: ",...JSON.parse(e))})),e.setProperty(t,"_playNote",e.createNativeFunction(e=>{let t=JSON.parse(e);"all"===t.device&&Object.keys(this.devices.outputs).forEach(e=>{const a=m.a.getOutputById(e);a.playNote(t.note,t.channel)})}))},addBlocks(){this.blocks.forEach(e=>{s.a.Blocks[e.name]={init:function(){this.jsonInit(e.json)}},s.a.JavaScript[e.name]=()=>"";const t=this.blockly.newBlock(e.name);t.initSvg(),t.render(),this.blockly.centerOnBlock(t.id),this.blockly.scroll(this.blockly.scrollX,this.blockly.scrollY)})}}},v=f,k=(a("8f13"),a("2877")),_=a("1c1c"),E=a("eb85"),w=a("66e5"),N=a("4074"),O=a("0016"),$=a("0170"),S=a("eebe"),T=a.n(S),C=Object(k["a"])(v,n,o,!1,null,null,null);t["a"]=C.exports;T()(C,"components",{QList:_["a"],QSeparator:E["a"],QItem:w["a"],QItemSection:N["a"],QIcon:O["a"],QItemLabel:$["a"]})},"8f13":function(e,t,a){"use strict";var n=a("c80c"),o=a.n(n);o.a},c80c:function(e,t,a){},cf36:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"full-height"},[a("Workspace",{ref:"workspace",attrs:{options:e.options,toolbox:e.toolbox,blocks:[]},on:{change:e.workspaceEventHandler}})],1)},o=[],r=(a("c975"),a("2ef0")),l=a("00d3"),i=a("8ded"),s=a.n(i),c=a("c62b"),u=a.n(c),d=a("54ca"),m=a.n(d),h=[{tag:"category",category:"event",name:"Events",icon:"fas fa-gamepad",colour:"#fad000",children:[]},{tag:"category",category:"event_modifier",name:"Event Modifiers",icon:"fas fa-filter",colour:"#FF9D00",children:[]},{tag:"category",category:"event_send",name:"Send Event",icon:"fas fa-broadcast-tower",colour:"#2EC4B6",children:[]},{tag:"sep",children:[]},{tag:"category",category:"logic",name:"Logic",colour:"#5D37F0",icon:"fas fa-code-branch fa-flip-vertical",children:[{tag:"block",type:"controls_if"},{tag:"block",type:"logic_compare",children:[{tag:"field",name:"OP",value:"EQ"}]},{tag:"block",type:"logic_operation",children:[{tag:"field",name:"OP",value:"AND"}]},{tag:"block",type:"logic_negate"},{tag:"block",type:"logic_boolean",children:[{tag:"field",name:"BOOL",value:"TRUE"}]},{tag:"block",type:"logic_null"},{tag:"block",type:"logic_ternary"}]},{tag:"category",name:"Loops",category:"loops",colour:"#2ca300",icon:"fas fa-infinity",children:[{tag:"block",type:"controls_repeat_ext",children:[{tag:"value",name:"TIMES",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:10}]}]}]},{tag:"block",type:"controls_whileUntil",children:[{tag:"field",name:"MODE",value:"WHILE"}]},{tag:"block",type:"controls_for",children:[{tag:"field",name:"VAR",id:"+x@[E{uUuMC(G!%lB~vF",value:"i"},{tag:"value",name:"FROM",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:1}]}]},{tag:"value",name:"TO",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:10}]}]},{tag:"value",name:"BY",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:1}]}]}]},{tag:"block",type:"controls_forEach",children:[{tag:"field",name:"VAR",id:"E`D{pL/f#h?~8#[VL5rC",value:"j"}]},{tag:"block",type:"controls_flow_statements",children:[{tag:"field",name:"FLOW",value:"BREAK"}]}]},{tag:"category",name:"Math",category:"events",colour:"#A599E9",icon:"fas fa-calculator",children:[{tag:"block",type:"math_number",children:[{tag:"field",name:"NUM",value:0}]},{tag:"block",type:"math_arithmetic",children:[{tag:"field",name:"OP",value:"ADD"},{tag:"value",name:"A",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:1}]}]},{tag:"value",name:"B",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:1}]}]}]},{tag:"block",type:"math_single",children:[{tag:"field",name:"OP",value:"ROOT"},{tag:"value",name:"NUM",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:9}]}]}]},{tag:"block",type:"math_trig",children:[{tag:"field",name:"OP",value:"SIN"},{tag:"value",name:"NUM",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:45}]}]}]},{tag:"block",type:"math_constant",children:[{tag:"field",name:"CONSTANT",value:"PI"}]},{tag:"block",type:"math_number_property",children:[{tag:"mutation",divisor_input:"false"},{tag:"field",name:"PROPERTY",value:"EVEN"},{tag:"value",name:"NUMBER_TO_CHECK",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:0}]}]}]},{tag:"block",type:"math_round",children:[{tag:"field",name:"OP",value:"ROUND"},{tag:"value",name:"NUM",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:3.1}]}]}]},{tag:"block",type:"math_on_list",children:[{tag:"mutation",op:"SUM"},{tag:"field",name:"OP",value:"SUM"}]},{tag:"block",type:"math_modulo",children:[{tag:"value",name:"DIVIDEND",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:64}]}]},{tag:"value",name:"DIVISOR",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:10}]}]}]},{tag:"block",type:"math_constrain",children:[{tag:"value",name:"VALUE",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:50}]}]},{tag:"value",name:"LOW",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:1}]}]},{tag:"value",name:"HIGH",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:100}]}]}]},{tag:"block",type:"math_random_int",children:[{tag:"value",name:"FROM",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:1}]}]},{tag:"value",name:"TO",children:[{tag:"shadow",type:"math_number",children:[{tag:"field",name:"NUM",value:100}]}]}]},{tag:"block",type:"math_random_float"}]},{tag:"sep",children:[]},{tag:"category",name:"Variables",icon:"fas fa-box",colour:"#ff628c",custom:"VARIABLE",children:[]},{tag:"category",name:"Functions",colour:"#ff628c",icon:"fas fa-plug",custom:"PROCEDURE",children:[]}],g={name:"MainLayout",components:{Workspace:l["a"]},mounted(){Object(r["set"])(window,"app.$studio",this),u.a.enable(e=>{const t={},a={};this.errors.webmidi.enable=e,u.a.inputs.forEach(e=>{t[e.id]=e,e.led=!1,e.lastMessage="",this.bindInput(e.id)}),u.a.outputs.forEach(e=>{a[e.id]=e}),this.$store.commit("set",["devices",{inputs:t,outputs:a}])});const e=s.a.get("currentStudio",{});e.workspace?m.a.Xml.domToWorkspace(m.a.Xml.textToDom(e.workspace),this.$refs.workspace.blockly):m.a.Xml.domToWorkspace(m.a.Xml.textToDom('<xml xmlns="https://developers.google.com/blockly/xml"></xml>'),this.$refs.workspace.blockly),this.$refs.workspace.blockly.addChangeListener(m.a.Events.disableOrphans)},watch:{splitter:Object(r["throttle"])((function(){s.a.set("splitter",this.splitter),setTimeout(()=>{window.dispatchEvent(new Event("resize"))})}),50,{leading:!0,trailing:!0})},data(){return{hasLoaded:!1,errors:{webmidi:{enable:!1}},options:{},toolbox:this.getToolbox(),splitter:s.a.get("splitter")||window.innerWidth/3}},methods:{workspaceEventHandler(e){switch(e.type){case m.a.Events.FINISHED_LOADING:this.hasLoaded=!0;break;case m.a.Events.BLOCK_CREATE:case m.a.Events.BLOCK_DELETE:case m.a.Events.BLOCK_CHANGE:case m.a.Events.BLOCK_MOVE:case m.a.Events.VAR_CREATE:case m.a.Events.VAR_DELETE:case m.a.Events.VAR_RENAME:this.$refs.workspace.run(),this.hasLoaded&&this.autosave();break}},getToolbox(){const e=Object(r["cloneDeep"])(h),t=s.a.get("blocks",{}),a=e.map(e=>e.category||"");return Object.keys(t).forEach(n=>{const o=t[n],r=a.indexOf(o.category);e[r]&&(e[r].children.push({tag:"block",type:o.json.type}),m.a.Blocks[o.json.type]={init:function(){this.jsonInit(o.json)}},m.a.JavaScript[o.json.type]=function(e){let t=[];return o.variables.forEach(a=>{if("field"===a.type)switch(a.field){case"variable":t.push(`var $${a.name} = ${JSON.stringify(m.a.JavaScript.variableDB_.getName(e.getFieldValue(a.name),m.a.Variables.NAME_TYPE))}`);break;case"angle":t.push(`var $${a.name} = ${e.getFieldValue(a.name)}`);break;case"colour":t.push(`var $${a.name} = ${JSON.stringify(e.getFieldValue(a.name))}`);break;case"checkbox":t.push(`var $${a.name} = ${"TRUE"===e.getFieldValue(a.name)?"true":"false"}`);break;case"dropdown":t.push(`var $${a.name} = ${JSON.stringify(e.getFieldValue(a.name))}`);break;case"number":t.push(`var $${a.name} = ${e.getFieldValue(a.name)}`);break;case"text":t.push(`var $${a.name} = ${JSON.stringify(e.getFieldValue(a.name))}`);break}else switch(a.input){case"value":t.push(`var $${a.name} = ${JSON.stringify(m.a.JavaScript.valueToCode(e,a.name,m.a.JavaScript.ORDER_ATOMIC))}`);break;case"statements":const n=m.a.JavaScript.statementToCode(e,a.name);t.push(`var $${a.name} = function () {\n${n}\n}`);break}}),t=t.join(";\n"),t+=";\n"+(o.code||""),e.outputConnection?[t,m.a.JavaScript.ORDER_NONE]:t})}),e},autosave(){s.a.set("currentStudio",{workspace:m.a.Xml.domToText(m.a.Xml.workspaceToDom(this.$refs.workspace.blockly))})},bindInput(e){const t=u.a.getInputById(e),a=["activesensing","channelaftertouch","channelmode","clock","continue","controlchange","keyaftertouch","noteoff","noteon","nrpn","pitchbend","programchange","reset","songposition","songselect","start","stop","sysex","timecode","tuningrequest","unknownsystemmessage"];a.forEach(e=>{t.addListener(e,"all",t=>{this.triggerEvent(e,t)})}),t.addListener("midimessage","all",e=>{this.$store.commit("set",[`devices.inputs['${e.target.id}'].led`,!0]),setTimeout(()=>{this.$store.commit("set",[`devices.inputs['${e.target.id}'].led`,!1])},10)})},triggerEvent(e,t){let a,n=Object.assign({},t);switch(n.target=Object.assign({},n.target),delete n.target._midiInput,delete n.target._userHandlers,delete n.target.lastMessage,n=JSON.stringify(n),this.$refs.workspace.interpreter.appendCode(`triggerEvent('${e}', '${n}')`),this.$refs.workspace.interpreter.run(),e){case"noteon":case"noteoff":a=`[${t.note.number}, ${t.note.name}, ${t.note.octave}]`;break;case"controlchange":a=`[${t.controller.number}, ${t.controller.name}]`;break}this.$store.commit("set",[`devices.inputs['${t.target.id}'].lastMessage`,`<div>\n          <strong>${e}</strong>:\n          <span>${a}</span>\n        </div>\n        <div>\n          <strong>data</strong>:\n          <span>[${t.data[0]}, ${t.data[1]}, ${t.data[2]}]</span>\n        </div>`])}}},p=g,b=a("2877"),y=a("9989"),f=a("eebe"),v=a.n(f),k=Object(b["a"])(p,n,o,!1,null,null,null);t["default"]=k.exports;v()(k,"components",{QPage:y["a"]})}}]);